<!DOCTYPE html>
<html lang="pt-br">

<head>
  <link rel="shortcut icon" href="/assets/icon/Pinguim_do_ep.ico" type="image/x-icon">
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/style.css">

  <title>Cadastro</title>

  <script src="./js/sessao.js"></script>
</head>

<body onload="listar()">
<div class="navbar">
    <div class="navbar-logo">
        <img src="./assets/imgs/index/icon pagina.png" alt="">
        <h3>Diario de um pinguin</h3> 
    </div>
    <div class="navbar-lista">
        <ul>
            <li><a href="index.html" style="color: inherit; text-decoration: none;">home</a></li>
            <li><a href="personagens.html" style="color: inherit; text-decoration: none;">Personagens</a></li>
            <li><a href="epf.html" style="color: inherit; text-decoration: none;">EPF</a></li>
            <li><a href="login.html" style="color: inherit; text-decoration: none;">Login</a></li>
        </ul>
    </div>
</div>


<div class="titulo-cadastro">
    <h1>Seja um pinguim</h1>
</div>
<div>
<div class="alerta_erro">
      <div class="card_erro" id="cardErro">
        <span id="mensagem_erro"></span>
      </div>
   </div>
</div>


<div class="container-cadastro">
    <div id="imagem-esquerda">
        <img src="https://i.redd.it/a-collection-of-my-favourite-gifs-i-extracted-from-the-club-v0-ivcx6810iigd1.gif?width=1626&auto=webp&s=a883f666bb214060cf8d6593461ac487eb154e29" alt="">
    </div>
        <div id="login-direita">
                <p>Nickname</p> <br>
                <input id="nick_input" type="text"> <br> <br>
                <p>Email</p> <br>
                <input id="email_input" type="email"> <br> <br>
                <div id="div_mensagem_erro"></div>
                <p>Senha</p> <br>
                <input id="senha_input" type="password"> <br> <br>
                <p>Confirme sua senha</p> <br>
                <input id="confirmacao_senha_input" type="password"> <br> <br> <br>
                <button onclick="cadastrar()">Cadastre-se</button>
        </div>
</div>
</div>

<div class="rodape">
    <div class="rodape-lista">
        <ul>
            <li><img src="./assets/imgs/index/instagram.webp" alt=""> @DiarioDeUmpInguin_</li>
            <li><img src="./assets/imgs/index/facebook.png" alt="">DiarioDeUmPinguim</li>
            <li><img src="./assets/imgs/index/x.webp" alt="">@Diario_Pinguin</li>
            <li><img src="./assets/imgs/index/github.png" alt="">IsabelaTeixeiraRodrigues</li>
            <li><img src="./assets/imgs/index/email.png" alt="">Diario_Pinguin@gmail.com</li>
        </ul>
    </div>
    <p>Todos os direitos reservados</p>
</div>
</body>

</html>

<script>

  let listaEmpresasCadastradas = [];
  var listaEspeciais = ['@','#','$','%','&','*'];

  function cadastrar() {

var nickVar = nick_input.value;
var emailVar = email_input.value;
var senhaVar = senha_input.value;
var confirmacaoSenhaVar = confirmacao_senha_input.value;
var senhaMinuscula = senhaVar.toLowerCase(); 

if (
    nickVar == "" ||
    emailVar == "" ||
    emailVar.includes("@") == false ||
    senhaVar == "" ||
    senhaVar.length < 8 ||
    senhaVar == senhaMinuscula || 
    (!senhaVar.includes("@") &&
    !senhaVar.includes("#") &&
    !senhaVar.includes("$") &&
    !senhaVar.includes("%") &&
    !senhaVar.includes("&") &&
    !senhaVar.includes("*")) || 
    confirmacaoSenhaVar == ""
) {
    alert("Preencha os campos corretamente!");
    finalizarAguardar();
    return false;
}

if (senhaVar != confirmacaoSenhaVar) {
    alert("As senhas nÃ£o coincidem!");
    return false;
}

    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
      nickServer: nickVar,
      emailServer: emailVar,
      senhaServer: senhaVar
    })
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          cardErro.style.display = "block";

          mensagem_erro.innerHTML =
            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

          limparFormulario();
          finalizarAguardar();
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });

    return false;
  }
</script>